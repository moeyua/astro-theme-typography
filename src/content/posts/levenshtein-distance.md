---
title: å¦‚ä½•å®ç° git å‘½ä»¤è¡Œçš„è”æƒ³åŠŸèƒ½
pubDate: 2020-05-22 16:06 PST
categories: ["èŠèŠæŠ€æœ¯"]
tags: Python, cli, Git, Levenshtein distance, è±æ–‡æ–¯å¦è·ç¦», ç®—æ³•
heroImage: /images/blog/git-ui-scaled.jpg
heroImageDescription: Photo by Yancy Min on Unsplash
---

## é—®é¢˜èƒŒæ™¯

ç å†œç”Ÿæ¶¯ç¦»ä¸å¼€ git ï¼Œæ— è®ºæ˜¯ç¼–ç å¼€å‘ï¼Œç‰ˆæœ¬æ§åˆ¶ï¼Œè¿˜æ˜¯æŒç»­é›†æˆï¼Œä»£ç å®¡æŸ¥ï¼Œ git æ— ç–‘æ˜¯æœ‰æ•ˆè·Ÿè¸ªé¡¹ç›®è¿›å±•çš„åˆ©å™¨ï¼Œè€Œ git å‘½ä»¤è¡Œæ›´æ˜¯å¿…ä¸å¯å°‘çš„å·¥å…·ã€‚æˆ‘ä¹‹å‰ä¹Ÿå°è¯•è¿‡ä¸€äº›å¸¦ç•Œé¢çš„ git å·¥å…·ï¼Œç„¶è€Œéƒ½æ²¡æœ‰å‘½ä»¤è¡Œæ¥çš„é¡ºæ‰‹ï¼ŒæŒ‰é’®å¤ªå¤šï¼Œç•Œé¢å¤ªå¤æ‚ï¼Œåè€Œå®¹æ˜“æä¸æ¸…æ¥šä¸€äº›ç®€å•çš„æ“ä½œåº”è¯¥å¦‚ä½•ä¸‹æ‰‹ã€‚

å‘½ä»¤è¡Œç”¨çš„å¤šäº†ï¼Œéš¾å…æœ‰æ‰‹æ»‘è¾“é”™å‘½ä»¤çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™å±å¹•ä¸Šå°±ä¼šæç¤º

```shell
ğŸ¼ ~ Â» git stats
git: 'stats' is not a git command. See 'git --help'.
The most similar command is
	status
```

å½“å¹´ç¬¬ä¸€æ¬¡ç”¨ git çš„æ—¶å€™è¿˜æ˜¯å°æƒŠå–œäº†ä¸€ä¸‹ï¼Œå› ä¸ºä¹‹å‰æ¥è§¦çš„å…¶ä»–å·¥å…·ä¸æ˜¯ç›´æ¥æç¤ºå‘½ä»¤æ‰¾ä¸åˆ°ï¼Œå°±æ˜¯ç›´æ¥è¾“å‡ºä¸€å¤§æ®µ help ç•Œé¢ï¼Œå¯¹ç”¨æˆ·å¾ˆä¸å‹å¥½ï¼Œæ‰€ä»¥ git èƒ½ç›´æ¥æŠŠæœ€æ¥è¿‘çš„å­å‘½ä»¤è¾“å‡ºåˆ°å±å¹•ä¸Šè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚

## ç®—æ³•ç®€ä»‹

é‚£ä¹ˆè¿™ä¸ªè´´å¿ƒçš„å°åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿå¾ˆè‡ªç„¶åœ°æƒ³åˆ°ï¼Œè¦æƒ³åŠæ³•å®šä¹‰ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´çš„â€œç›¸ä¼¼ç¨‹åº¦â€ï¼Œæ¢å¥è¯è¯´ï¼Œè¦æ‰¾åˆ°ä¸€ä¸ªåº¦é‡è¡¡ï¼Œæ¥é‡åŒ–ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´çš„ä¸åŒç¨‹åº¦ä¸ºå¤šå¤§ï¼Œç„¶åéå†ä¸€é git çš„å­å‘½ä»¤ï¼Œæ‰¾å‡ºä¸åŒç¨‹åº¦æœ€å°çš„é‚£ä¸ªè¿”å›å³å¯ã€‚è¿™ä¸ªåº¦é‡è¡¡æ—©åœ¨ 1965 å¹´å‰è‹è”æ•°å­¦å®¶ [Vladimir Levenshtein](https://en.wikipedia.org/wiki/Vladimir_Levenshtein) å°±å·²ç»ç»™å‡ºäº†å®šä¹‰ï¼Œå› æ­¤å‘½åä¸º [Levenshtein Distance](https://en.wikipedia.org/wiki/Levenshtein_distance) ï¼ˆè±æ–‡æ–¯å¦è·ç¦»ï¼‰ã€‚å†…å®¹å¾ˆç®€å•ï¼Œç›¸ä¼¼ç¨‹åº¦å¯ä»¥ç”¨ä¸¤ä¸ªå­—ç¬¦ä¸²çš„**ç¼–è¾‘è·ç¦»**æ¥é‡åŒ–ï¼Œå³ç»™å‡ºå­—ç¬¦ä¸²ç”²å’Œå­—ç¬¦ä¸²ä¹™ï¼Œåªé€šè¿‡**æ·»åŠ **ä¸€ä½å­—æ¯ï¼Œ**åˆ é™¤**ä¸€ä½å­—æ¯ï¼Œæˆ–è€…**æ›¿æ¢**ä¸€ä½å­—æ¯çš„æ“ä½œï¼Œæœ€å°‘ç»è¿‡å¤šå°‘æ¬¡æ“ä½œèƒ½æŠŠå­—ç¬¦ä¸²ç”²å˜æˆå­—ç¬¦ä¸²ä¹™ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå­—ç¬¦ä¸² `kitten` å’Œ `sitten` çš„ç¼–è¾‘è·ç¦»æ˜¯å¤šå°‘ï¼Ÿæ˜¾ç„¶æ˜¯ 1 ï¼Œå› ä¸ºæŠŠé¦–ä½å­—æ¯**æ›¿æ¢**ä¸º s å³å¯æˆä¸ºåè€…ã€‚å†æ¥ä¸€ä¸ªï¼Œå­—ç¬¦ä¸² `abd` å’Œ `abcd` çš„ç¼–è¾‘è·ç¦»ä¹Ÿæ˜¯ 1 ï¼Œå› ä¸ºåªéœ€è¦**æ·»åŠ **ä¸€ä¸ªå­—æ¯ c å°±å¾—åˆ°äº†åè€…ã€‚ä½†æ˜¯å­—ç¬¦ä¸²æœ‰å¾ˆå¤šï¼Œå¤æ‚çš„æƒ…å†µæ— ç©·æ— å°½ï¼Œæ¯”å¦‚è¯´ `September` å’Œ `October` çš„ç¼–è¾‘è·ç¦»å°±ä¸å®¹æ˜“ä¸€çœ¼çœ‹å‡ºæ¥ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªç®—æ³•æ¥å¸®æˆ‘ä»¬è®¡ç®—è¿™ä¸ªç»“æœã€‚

å…ˆè€ƒè™‘æœ€ç®€å•çš„æƒ…å†µï¼Œå½“ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºçš„æ—¶å€™ï¼Œç¼–è¾‘è·ç¦»è‡ªç„¶æ˜¯å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå› ä¸ºåªéœ€è¦é€šè¿‡ç®€å•çš„æ·»åŠ æ“ä½œï¼Œå°±èƒ½æŠŠä¸€ä¸ªç©ºå­—ç¬¦ä¸²å˜æˆå¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ–è€…é€šè¿‡ç®€å•çš„åˆ é™¤æ“ä½œï¼Œå°±èƒ½æŠŠä¸€ä¸ªéç©ºå­—ç¬¦ä¸²å˜æˆç©ºå­—ç¬¦ä¸²ã€‚

ç„¶åæ˜¯æ¯”è¾ƒå¤æ‚çš„æƒ…å†µï¼Œå½“ä¸¤ä¸ªå­—ç¬¦ä¸²éƒ½ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œåº”è¯¥å¦‚ä½•å¾—åˆ°å®ƒä»¬çš„ç¼–è¾‘è·ç¦»ï¼Ÿæˆ‘ä»¬å…ˆå‡è®¾ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­ä¸²çš„ç¼–è¾‘è·ç¦»å·²çŸ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—å‡ºè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç¼–è¾‘è·ç¦»ã€‚å…·ä½“è¯´æ¥ï¼Œå‡å¦‚ä¸¤ä¸ªå­—ç¬¦ä¸²åˆ†åˆ«å‘½åä¸º `str1` å’Œ `str2` ï¼Œå·²çŸ¥ä¸‹åˆ—å­ä¸²çš„ç¼–è¾‘è·ç¦»ï¼ˆä¸ºè¯´æ˜æ–¹ä¾¿ï¼Œæˆ‘è¿™é‡Œçš„å­ä¸²ç”¨ Python çš„è¯­æ³•æ¥è¡¨ç¤ºï¼‰

- `str1[:-1]` -> `str2[:-1]`

- `str1[:-1]` -> `str2`

- `str1` -> `str2[:-1]`

å·²çŸ¥ç¬¬ä¸€ç§æƒ…å†µä¸‹çš„ç¼–è¾‘è·ç¦»ï¼Œæˆ‘ä»¬åªéœ€è¦æ¯”è¾ƒ `str1` å’Œ `str2` çš„æœ€åä¸€ä½å­—æ¯ï¼Œå¦‚æœç›¸åŒçš„è¯ï¼Œ `str1` å’Œ `str2` çš„ç¼–è¾‘è·ç¦»å…¶å®ä¸ `str1[:-1]` å’Œ `str2[:-1]` çš„ç¼–è¾‘è·ç¦»æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å¯¹æœ€åä¸€ä½å­—æ¯åšä»»ä½•æ“ä½œã€‚å¦‚æœæœ€åä¸€ä½å­—æ¯ä¸ç›¸åŒçš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç¬¬ä¸€ç§æƒ…å†µçš„åŸºç¡€ä¸Šåšä¸€æ¬¡**æ›¿æ¢**ï¼Œå°±èƒ½å¾—åˆ° `str2` äº†ï¼Œæ‰€ä»¥è¿™æ—¶ str1 å’Œ str2 çš„ç¼–è¾‘è·ç¦»ä¸º `str1[:-1]` å’Œ `str2[:-1]` çš„ç¼–è¾‘è·ç¦»åŠ ä¸€ã€‚

å·²çŸ¥ `str1[:-1]` -> `str2` çš„ç¼–è¾‘è·ç¦»ï¼Œ `str1` åˆ° `str1[:-1]` çš„è·ç¦»æ˜¾ç„¶æ˜¯ 1 ï¼Œåªè¦**åˆ é™¤**æœ€åä¸€ä½å­—æ¯å°±è¡Œäº†ï¼Œæ‰€ä»¥ str1 åˆ° str2 çš„ç¼–è¾‘è·ç¦»ä¸º `str1[:-1]` -> `str2` åŠ ä¸€ï¼Œå…·ä½“æ“ä½œä¸º `str1` -> `str1[:-1]` -> `str2` ã€‚æ•°å­¦å®¶å˜›ï¼Œæ€»æ˜¯å–œæ¬¢æŠŠä¸€ä¸ªæœªçŸ¥çš„é—®é¢˜è½¬åŒ–æˆä¸€ä¸ªå·²çŸ¥çš„é—®é¢˜æ¥è§£å†³ã€‚

åŒæ ·åœ°ï¼Œå·²çŸ¥ `str1` -> `str2[:-1]` çš„è·ç¦»ï¼Œåªéœ€è¦ç»™ `str2[:-1]` **æ·»åŠ **æœ€åä¸€ä½å­—æ¯ï¼Œå°±å¾—åˆ°äº† `str1` -> `str2` çš„ç¼–è¾‘è·ç¦»ã€‚

æœ€åï¼Œä»ä¸Šè¿°ä¸‰ç§æƒ…å†µå¾—åˆ°çš„ç¼–è¾‘è·ç¦»ä¸­å–æœ€å°ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚

ä½†é—®é¢˜è¿˜æ²¡å®Œï¼Œä¸Šè¿°ä¸‰ç§æƒ…å†µçš„ç¼–è¾‘è·ç¦»æˆ‘ä»¬æ˜¯â€œå‡è®¾â€å®ƒä»¬å·²çŸ¥äº†ï¼Œè€Œå®é™…æƒ…å†µä¸­æˆ‘ä»¬æ˜¯æ— æ³•ç›´æ¥å¾—åˆ°å®ƒä»¬çš„ç¼–è¾‘è·ç¦»çš„ã€‚è€ƒè™‘ä¸€ä¸‹ä¸€å¼€å§‹æè¿‡çš„â€œæœ€ç®€å•çš„æƒ…å†µâ€ï¼ŒåŸºäºå®ƒä»¬ï¼Œä¸€æ­¥æ­¥å‘å¤æ‚çš„æƒ…å†µæ¨è¿›ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“åœ°å°±å¾—åˆ°äº†æ‰€æœ‰æƒ…å†µçš„ç¼–è¾‘è·ç¦»ã€‚

äºæ˜¯ï¼Œè¿™ä¸ªç®—æ³•å°±æœ‰äº†å½¢å¼åŒ–çš„å®šä¹‰ã€‚è®°å­—ç¬¦ä¸² a ä¸ b çš„ç¼–è¾‘è·ç¦»ä¸º \[katex display=true\]lev\_{a,b}(|a|, |b|)\[/katex\]å…¶ä¸­ |a| å’Œ |b| åˆ†åˆ«è¡¨ç¤º a ä¸ b çš„é•¿åº¦ï¼Œå¯ä»¥å¾—åˆ°æ¨å¯¼å…¬å¼

```
lev_{a,b}(i, j)=\begin{cases}
    \begin{array}{ll}
        max(i, j) & if min(i, j)=0, \\
        min
        \begin{cases}
            \begin{array}{ll}
                lev_{a,b}(i-1,j) + 1 \\
                lev_{a,b}(i,j-1) + 1 \\
                lev_{a,b}(i-1,j-1) + 1_{a_i \ne b_j}
            \end{array}
        \end{cases} & otherwise.
    \end{array}
\end{cases}
```

è¿™ä¸ªå…¬å¼æ˜¯ç”¨é€’å½’çš„å½¢å¼å®šä¹‰çš„ï¼Œä½†å·¥ç¨‹å®ç°çš„æ—¶å€™æˆ‘ä¸€èˆ¬ä¼šå€¾å‘äºé¿å…è¿™ç§æ–¹å¼ï¼Œé˜²æ­¢åœ¨è¾“å…¥è¿‡é•¿çš„æ—¶å€™çˆ†æ ˆï¼Œè¿™é‡Œå¯ä»¥ç”¨çŸ©é˜µæ¥å­˜å‚¨ `lev(i,j)` çš„å€¼ã€‚ä»¥[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Levenshtein_distance)ä¸Šçš„ `sitting` å’Œ `kitten` çš„ç¼–è¾‘è·ç¦»ä¸ºä¾‹ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢ä¸€ä¸ªçŸ©é˜µï¼Œå³ä¸‹è§’çš„ 3 å³ä¸ºå®ƒä»¬çš„ç¼–è¾‘è·ç¦»ã€‚

<table class="wikitable"><tbody><tr><td></td><td></td><th>k</th><th>i</th><th>t</th><th>t</th><th>e</th><th>n</th></tr><tr><td></td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td></tr><tr><th>s</th><td>1</td><td><span title="substitution of 'k' for 's'" class="rt-commentedText" style="border-bottom:1px dotted">1</span></td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td></tr><tr><th>i</th><td>2</td><td>2</td><td><span title="'i' equals 'i'" class="rt-commentedText" style="border-bottom:1px dotted">1</span></td><td>2</td><td>3</td><td>4</td><td>5</td></tr><tr><th>t</th><td>3</td><td>3</td><td>2</td><td><span title="'t' equals 't'" class="rt-commentedText" style="border-bottom:1px dotted">1</span></td><td>2</td><td>3</td><td>4</td></tr><tr><th>t</th><td>4</td><td>4</td><td>3</td><td>2</td><td><span title="'t' equals 't'" class="rt-commentedText" style="border-bottom:1px dotted">1</span></td><td>2</td><td>3</td></tr><tr><th>i</th><td>5</td><td>5</td><td>4</td><td>3</td><td>2</td><td><span title="substitution of 'e' for 'i'" class="rt-commentedText" style="border-bottom:1px dotted">2</span></td><td>3</td></tr><tr><th>n</th><td>6</td><td>6</td><td>5</td><td>4</td><td>3</td><td>3</td><td><span title="'n' equals 'n'" class="rt-commentedText" style="border-bottom:1px dotted">2</span></td></tr><tr><th>g</th><td>7</td><td>7</td><td>6</td><td>5</td><td>4</td><td>4</td><td><span title="delete'g'" class="rt-commentedText" style="border-bottom:1px dotted">3</span></td></tr></tbody></table>

Python ç¼–ç å®ç°å¦‚ä¸‹ï¼Œ

```python
def levenshtein_distance(str1, str2):
    rows = len(str1)
    cols = len(str2)
    lev = [[0 for _ in range(cols+1)] for _ in range(rows+1)]
    for i in range(rows+1):
        lev[i][0] = i
    for j in range(cols+1):
        lev[0][j] = j
    for i in range(1, rows+1):
        for j in range(1, cols+1):
            lev[i][j] = min(
                lev[i-1][j] + 1,
                lev[i][j-1] + 1,
                lev[i-1][j-1] + (0 if str1[i-1] == str2[j-1] else 1)
            )
    return lev[rows][cols]
```

è¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦éƒ½ä¸º O(M\*N) ï¼Œ M å’Œ N åˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚

å›åˆ° git å‘½ä»¤è¡Œï¼Œ git çš„å­å‘½ä»¤ä¸è¿‡åªæœ‰äºŒåå‡ ä¸ªï¼Œæœ€é•¿çš„ä¹Ÿä¸è¿‡ 8 ä¸ªå­—æ¯ï¼Œæ‰€ä»¥å½“é‡åˆ°æ— æ³•è¯†åˆ«çš„å‘½ä»¤æ—¶ï¼Œä¸€ä¸€è®¡ç®—è¾“å…¥çš„å­å‘½ä»¤å’Œå·²æœ‰çš„å­å‘½ä»¤ä¹‹é—´çš„ç¼–è¾‘è·ç¦»ï¼Œå°±èƒ½å¿«é€Ÿæ‰¾åˆ°æœ€ç›¸è¿‘çš„ä¸€ä¸ªå¹¶è¿”å›åˆ°å±å¹•ä¸Šã€‚å½“ç„¶äº†ï¼Œ git ä¹Ÿä¸ä¼šèƒ¡ä¹±æ¨èï¼Œå¦‚æœè¾“å…¥çš„å­å‘½ä»¤å¤ªè¿‡äºå¥‡è‘©ï¼Œä»¤ç¼–è¾‘è·ç¦»è¿‡å¤§ï¼Œ git æ˜¯ä»€ä¹ˆè¯ä¹Ÿä¸ä¼šè¯´çš„ã€‚

```shell
ğŸ¼ ~ Â» git abcdefg
git: 'abcdefg' is not a git command. See 'git --help'.
```

## 2022/02/19 æ›´æ–°

æœ€è¿‘åœ¨[å­¦ä¹ äº†è§£ Go è¯­è¨€çš„å‘½ä»¤è¡Œå·¥å…·ç”Ÿæˆå™¨ Cobra](https://old-panda.com/posts/write-a-cli-using-golang-cobra/) ï¼Œç®€å•çœ‹äº†ä¸‹å®ƒçš„æºç ï¼Œå‘ç°ä¹Ÿæœ‰å­å‘½ä»¤è”æƒ³åŠŸèƒ½ï¼Œå®ç°çš„å°±æ˜¯å­—ç¬¦ä¸²ä¹‹é—´çš„[è±æ¸©æ–¯å¦è·ç¦»](https://github.com/spf13/cobra/blob/v1.3.0/cobra.go#L166)ï¼Œè€Œåœ¨ä¸€ä¼—å­å‘½ä»¤ä¸­å¯»æ‰¾æœ€ä¸ºç›¸ä¼¼çš„[é€»è¾‘](https://github.com/spf13/cobra/blob/v1.3.0/command.go#L727)ï¼Œä¸æœ¬æ–‡å†™ä½œæ—¶æ¨æµ‹çš„æœ‰äº›ä¸åŒï¼Œ Cobra ä¼šè®¾å®šä¸€ä¸ªè·ç¦»çš„é˜ˆå€¼ï¼Œå°†è±æ¸©æ–¯å¦è·ç¦»å°äºç­‰äºè¿™ä¸ªé˜ˆå€¼çš„å­å‘½ä»¤åŠ å…¥æ•°ç»„ç­‰å¾…è¿”å›ï¼ŒåŒæ—¶è€ƒè™‘äº†ç”¨æˆ·çš„è¾“å…¥æ˜¯å¦ä¸ºæŸä¸ªæœ‰æ•ˆå­å‘½ä»¤çš„å‰ç¼€ã€‚

## å‚è€ƒèµ„æ–™

- [https://en.wikipedia.org/wiki/Levenshtein\_distance](https://en.wikipedia.org/wiki/Levenshtein_distance)

- [https://leetcode-cn.com/problems/edit-distance/](https://leetcode-cn.com/problems/edit-distance/)

- [Cobra v1.3.0 æºç ](https://github.com/spf13/cobra/tree/v1.3.0)
